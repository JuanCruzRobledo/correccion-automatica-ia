{
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "corregir",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -3392,
        -96
      ],
      "id": "858d031e-2e37-4de5-934e-394c9168e6dc",
      "name": "Corregir",
      "webhookId": "10bedb69-6f95-4b32-9c30-db354eb020ff"
    },
    {
      "parameters": {
        "operation": "fromJson",
        "binaryPropertyName": "rubric",
        "destinationKey": "rubric",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -3168,
        -96
      ],
      "id": "6b2877a1-413c-4849-a632-7300e2e2b244",
      "name": "Pasar rubrica a Texto"
    },
    {
      "parameters": {
        "resource": "document",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "text": "=Eres un corrector automÃ¡tico consistente y determinista. Tu Ãºnica fuente de verdad es la rÃºbrica JSON provista.\nNo interpretes, no inventes criterios, no asignes puntos por intuiciÃ³n.\nTu objetivo es producir una calificaciÃ³n reproducible (entera 0â€“100) a partir de los criterios, pesos y penalizaciones definidos.\n\nEntradas\n\nRUBRICA PARA CORREGIR: {{ $('Pasar rubrica a Texto').item.json.toJsonString() }}\n\n\n\nentrega: contenido textual del examen o archivo del alumno (por ejemplo, cÃ³digo fuente).\n\n\nProceso de evaluaciÃ³n\n\nInterpretaciÃ³n de la rÃºbrica\n\nUsa exclusivamente los campos definidos en criteria, penalties, mandatory_fail_conditions.\n\nConsidera grading.total_points como el total mÃ¡ximo (por defecto 100).\n\nCada criterio tiene un weight (0..1). Su puntaje mÃ¡ximo es weight * total_points.\n\nEvaluaciÃ³n de criterios (nota_original)\n\nPara cada criterio:\n\nEvalÃºa objetivamente si la entrega cumple completamente (100%), parcialmente (50%) o no cumple (0%) segÃºn la descripciÃ³n textual del criterio.\n\nMultiplica el grado de cumplimiento por el peso del criterio y por el total de puntos.\n\nSuma todos los puntajes parciales.\n\nRedondea el total al entero mÃ¡s cercano (usar half_up si se define).\n\nAsegura que nota_original sea un nÃºmero entero entre 0 y 100.\n\nPenalizaciones\n\nRecorre los penalties.\n\nSi la entrega incurre en alguna penalizaciÃ³n (por ejemplo, estructuras prohibidas, validaciones ausentes, mensajes incoherentes), resta el porcentaje indicado.\n\nAplica los descuentos multiplicativamente:\nnota_penalizada = nota_original * Î (1 - penalty_percent/100)\n\nSi mandatory_fail_conditions se cumple, recorta la nota final al mÃ¡ximo indicado (max_final_score del 10%, 15%, etc.).\n\nRedondea el resultado final al entero mÃ¡s cercano entre 0 y 100.\n\nrecomendaciones: ofrece acciones especÃ­ficas y concretas (mÃ¡x. 4 Ã­tems) para mejorar esos criterios en una prÃ³xima entrega.\n\nConsistencia\n\nCada vez que se procese la misma entrega con la misma rÃºbrica, el resultado debe ser idÃ©ntico (determinismo total).\n\nNo uses sinÃ³nimos, intuiciÃ³n ni estilo narrativo.\n\nLos puntajes se basan exclusivamente en las frases de la rÃºbrica y sus pesos.\n\nSalida obligatoria\n\nDevuelve Ãºnicamente una salida con esta plantilla de ejemplo (NO HACE FALTA QUE SEAN LOS MISMOS CRITERIOS QUE LA PLANTILLA, LOS CRITERIOS DEBEN SER LOS criteria.id, LOS TITULOS LOS critaria.name, Y SU PUNTAJE criteria.weight NO UTILICES LOS TASK COMO CRITERIOS),\n\nEJEMPLO: \n\nRubrica -->\n    \"criteria\": [\n    {\n      \"id\": \"C1\",\n      \"name\": \"Correctitud funcional y lÃ³gica\",\n      \"weight\": 0.25\n    }\n    {\n      \"id\": \"C2\",\n      \"name\": \"ManipulaciÃ³n de Listas (IndexaciÃ³n, Slicing y MÃ©todos)\",\n      \"weight\": 0.2\n    }\nDevolucion -->\nâœ…C1 â€” Correctitud funcional y lÃ³gica: 24 / 25 Â· El cÃ³digo es legible, estÃ¡ bien indentado, utiliza nombres de variables significativos y presenta una estructura lÃ³gica fÃ¡cil de seguir.\n\nâš ï¸C2 â€” ManipulaciÃ³n de Listas (IndexaciÃ³n, Slicing y MÃ©todos): 15 / 20 Â· Se implementan de manera incorrecta ciertas operaciones de las listas.\n\nDEBES MARCAR cada uno de los criterios con emoji segun su % de completitud para cada weight [âœ… = 80% - 100%, âš ï¸ = 60% - 79%, âŒ = 0% - 59%], ademas, al calificar cada criterio debes poner cuantos puntos obtuvo seguido de los puntos totales para ese criterio, ejemplo 10/15:\n\nHola ğŸ‘‹\n\nTu nota final es 8.\n\nğŸ“Œ Resumen por criterios\n\nâœ…C1 â€” ImplementaciÃ³n de Entidades del Dominio: 90 / 100 Â· ImplementaciÃ³n de la mayorÃ­a de las entidades del dominio. Persona no es abstracta. Falta validaciÃ³n de DNI con regex en el constructor de Persona.\n\nâŒC2 â€” ImplementaciÃ³n de LÃ³gica de Negocio (Service Pattern): 40 / 100 Â· Implementa la interface CitaService y la clase CitaManager, pero los mÃ©todos guardarCitas() y cargarCitas() estÃ¡n vacÃ­os. No usa ConcurrentHashMap para thread-safety. No se implementan las validaciones completas en programarCita().\n\nâŒC3 â€” Validaciones y Reglas de Negocio: 40 / 100 Â· ValidaciÃ³n de fecha futura y costo positivo implementadas. No se validan la disponibilidad de mÃ©dico/sala ni la compatibilidad de especialidades. ValidaciÃ³n de DNI implementada. ValidaciÃ³n de MatrÃ­cula implementada. Validaciones de strings no nulos/vacÃ­os implementadas.\n\nâš ï¸C4 â€” Patrones de DiseÃ±o y Arquitectura: 70 / 100 Â· PatrÃ³n Service implementado (CitaService/CitaManager). Enums implementados (TipoSangre, EspecialidadMedica, EstadoCita). Persona no es abstracta, por lo que no se aplica Template Method. CitaManager centraliza la coordinaciÃ³n de citas. SeparaciÃ³n de responsabilidades implementada. Uso apropiado de atributos final para datos core en Cita.\n\nâœ…C5 â€” Relaciones y Asociaciones entre Entidades: 80 / 100 Â· Relaciones Hospital â†” Departamento y Hospital â†” Paciente implementadas. RelaciÃ³n Departamento â†” Medico implementada. RelaciÃ³n Departamento â†” Sala implementada. RelaciÃ³n Paciente â†” HistoriaClinica implementada. RelaciÃ³n Cita â†” (Paciente, Medico, Sala) implementada. PrevenciÃ³n de duplicados implementada.\n\nâŒC6 â€” Persistencia de Datos (CSV): 40 / 100 Â· MÃ©todo toCsvString() en Cita implementado. MÃ©todo fromCsvString() en Cita implementado. MÃ©todos guardarCitas() y cargarCitas() en CitaManager no implementados.\n\nâœ…C7 â€” Programa Main - DemostraciÃ³n Completa: 80 / 100 Â· InicializaciÃ³n de Hospital y Departamentos implementada. Registro de mÃ©dicos con especialidades implementado. Registro de pacientes con historias clÃ­nicas implementado. ProgramaciÃ³n de citas implementada. Consultas del sistema implementadas. Persistencia no implementada. Validaciones no implementadas. EstadÃ­sticas implementadas. El programa se ejecuta sin errores.\n\nâœ…C8 â€” Calidad de CÃ³digo y Buenas PrÃ¡cticas: 100 / 100 Â· Nomenclatura correcta. CÃ³digo bien estructurado. EncapsulaciÃ³n implementada. Manejo de excepciones implementado. Comentarios implementados. Â· Sin evidencia concreta â‡’ No se penaliza, sÃ³lo se recomienda.\n\nğŸ’¡ Fortalezas detectadas\n\nğŸŒŸ Buen uso de Lombok para reducir el boilerplate code.\nğŸŒŸ ImplementaciÃ³n de la mayorÃ­a de las entidades del dominio.\n\nğŸ› ï¸ Recomendaciones\n\nEl proyecto presenta una buena estructura y organizaciÃ³n, con un uso adecuado de JPA para la persistencia de datos. Sin embargo, la falta de implementaciÃ³n de la persistencia CSV y algunas validaciones crÃ­ticas impactan negativamente en la nota final. AdemÃ¡s, la clase Persona debe ser abstracta para cumplir con el patrÃ³n Template Method.\n\n",
        "inputType": "binary",
        "binaryPropertyName": "submission",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -2944,
        -96
      ],
      "id": "3863daf6-0a2b-4fa6-8d7d-7d9516e7fca9",
      "name": "Corregir con IA",
      "credentials": {
        "googlePalmApi": {
          "id": "9NXpuKpoG8063PFw",
          "name": "maty2"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a3cfeea9-a8a0-4fc7-aa97-603c83d6d296",
              "name": "respuesta",
              "value": "={{ $json.content.parts[0].text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2720,
        -96
      ],
      "id": "43585acf-6c70-4f4f-9eae-7ccbd1ee1bfe",
      "name": "Setear respuesta de Gemini"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.respuesta }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -2496,
        -96
      ],
      "id": "cbbb3478-de67-4e5c-906f-f5670cd80787",
      "name": "Enviar correccion"
    }
  ],
  "connections": {
    "Corregir": {
      "main": [
        [
          {
            "node": "Pasar rubrica a Texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pasar rubrica a Texto": {
      "main": [
        [
          {
            "node": "Corregir con IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Corregir con IA": {
      "main": [
        [
          {
            "node": "Setear respuesta de Gemini",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Setear respuesta de Gemini": {
      "main": [
        [
          {
            "node": "Enviar correccion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "f0981ae4c0ef6f915f0b46ae60edab85d4bd6cddc77dbd7c3bcb8e7a3ea6e2a7"
  }
}