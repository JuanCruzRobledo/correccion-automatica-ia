{
  "name": "Create Course Folder",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "create-course-folder",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [240, 300],
      "id": "webhook-course",
      "name": "Webhook - Create Course",
      "webhookId": ""
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1",
              "name": "course_id",
              "value": "={{ $json.body.course_id }}",
              "type": "string"
            },
            {
              "id": "2",
              "name": "career_id",
              "value": "={{ $json.body.career_id }}",
              "type": "string"
            },
            {
              "id": "3",
              "name": "faculty_id",
              "value": "={{ $json.body.faculty_id }}",
              "type": "string"
            },
            {
              "id": "4",
              "name": "university_id",
              "value": "={{ $json.body.university_id }}",
              "type": "string"
            },
            {
              "id": "5",
              "name": "root_folder_url",
              "value": "={{ $json.body.root_folder_url || 'https://drive.google.com/drive/u/0/folders/' + $env.GOOGLE_DRIVE_ROOT_FOLDER_ID }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [460, 300],
      "id": "set-variables",
      "name": "Set Variables"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "={{ $json.university_id }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json.root_folder_url }}",
            "mode": "url",
            "__regex": "https:\\/\\/drive\\.google\\.com(?:\\/.*|)\\/folders\\/([0-9a-zA-Z\\-_]+)(?:\\/.*|)"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [680, 300],
      "id": "search-university-folder",
      "name": "Search University Folder",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "={{ $('Set Variables').item.json.faculty_id }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json.id }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [900, 300],
      "id": "search-faculty-folder",
      "name": "Search Faculty Folder",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "={{ $('Set Variables').item.json.career_id }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json.id }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [1120, 300],
      "id": "search-career-folder",
      "name": "Search Career Folder",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "={{ $('Set Variables').item.json.course_id }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [1340, 300],
      "id": "create-folder-drive",
      "name": "Create Folder in Drive",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: true, folder_name: $json.name, folder_id: $json.id, message: 'Carpeta de curso creada exitosamente' } }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [1560, 300],
      "id": "respond-success",
      "name": "Respond Success"
    }
  ],
  "connections": {
    "Webhook - Create Course": {
      "main": [
        [
          {
            "node": "Set Variables",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Variables": {
      "main": [
        [
          {
            "node": "Search University Folder",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search University Folder": {
      "main": [
        [
          {
            "node": "Search Faculty Folder",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search Faculty Folder": {
      "main": [
        [
          {
            "node": "Search Career Folder",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search Career Folder": {
      "main": [
        [
          {
            "node": "Create Folder in Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Folder in Drive": {
      "main": [
        [
          {
            "node": "Respond Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "tags": []
}
